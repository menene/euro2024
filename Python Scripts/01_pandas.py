# -*- coding: utf-8 -*-
"""Pandas.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1LunIpF5ttKd-gOWF-gn2LSAR2OSI2IfM

![pandas.svg](data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA4MTguNjMgMzMxLjIxIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6IzEzMDc1NDt9LmNscy0ye2ZpbGw6I2ZmY2EwMDt9LmNscy0ze2ZpbGw6I2U3MDQ4ODt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkFydGJvYXJkIDYzPC90aXRsZT48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik0yOTAuODUsMTk5LjIxYy0xMC4yNywwLTIwLjczLTQuMjUtMjcuMjgtMTIuNTh2NDVIMjQzbDAtMTExLjA5aDE4LjZsLjcxLDEyLjIyYzYuMzgtOS4zOSwxNy43MS0xNC4zNSwyOC41Mi0xNC4zNSwyMC43MywwLDM2LDE3LjM3LDM2LDQwLjRTMzExLjU4LDE5OS4yMiwyOTAuODUsMTk5LjIxWm0tNi4zNy02NS41NWMtMTIuMDUsMC0yMS43OSw5LjM5LTIxLjc5LDI1LjE2UzI3Mi40MywxODQsMjg0LjQ4LDE4NHMyMS43OS05LjM5LDIxLjc5LTI1LjE2UzI5Ni41MywxMzMuNjYsMjg0LjQ4LDEzMy42NloiLz48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik00MDQuMzYsMTk3LjFsLS43MS0xMi4yMmMtNi4zOCw5LjM5LTE3LjcyLDE0LjM1LTI4LjUzLDE0LjM0LTIwLjczLDAtMzYtMTcuMzYtMzYtNDAuMzlzMTUuMjQtNDAuNCwzNi00MC4zOWMxMC44MSwwLDIyLjE1LDUsMjguNTMsMTQuMzVsLjcxLTEyLjIySDQyM1YxOTcuMVptLTIyLjg1LTYzLjQzYy0xMi4wNSwwLTIxLjc5LDkuMzktMjEuOCwyNS4xNlMzNjkuNDUsMTg0LDM4MS41LDE4NHMyMS44LTkuMzksMjEuOC0yNS4xNlMzOTMuNTYsMTMzLjY3LDM4MS41MSwxMzMuNjdaIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDk0Ljg3LDE5Ny4xMVYxNTQuNzdjMC0xNC44OC01LjEzLTE5Ljg0LTE0LjUyLTE5Ljg0LTkuNzUsMC0yMC4zOCw4Ljg1LTIwLjM4LDE5LjQ4djQyLjdINDM5LjQxVjEyMC41N0g0NTguMmwuODksMTQuMThjNS4xNC05Ljc1LDE2LjY1LTE2LjMsMjguMzUtMTYuMywyMC4zNywwLDI4LDE0LjE4LDI4LDMzLjEzdjQ1LjU0WiIvPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTU5MC43NywxOTcuMTNsLS43MS0xMi4yM2MtNi4zOCw5LjM5LTE3LjcyLDE0LjM1LTI4LjUyLDE0LjM1LTIwLjczLDAtMzYtMTcuMzctMzYtNDAuNHMxNS4yNC00MC4zOSwzNi00MC4zOWMxMC4yNywwLDIwLjcyLDQuMjYsMjcuMjgsMTIuNThWOTAuODNoMjAuNTZsMCwxMDYuM1pNNTY3LjkyLDEzMy43Yy0xMiwwLTIxLjc5LDkuMzktMjEuNzksMjUuMTVTNTU1Ljg3LDE4NCw1NjcuOTIsMTg0czIxLjc5LTkuMzgsMjEuNzktMjUuMTVTNTgwLDEzMy43LDU2Ny45MiwxMzMuN1oiLz48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik02ODYuNiwxOTcuMTRsLS43MS0xMi4yMmMtNi4zOCw5LjM5LTE3LjcyLDE0LjM0LTI4LjUzLDE0LjM0LTIwLjczLDAtMzYtMTcuMzYtMzYtNDAuNHMxNS4yNC00MC4zOSwzNi00MC4zOWMxMC44MSwwLDIyLjE1LDUsMjguNTMsMTQuMzZsLjcxLTEyLjIzaDE4LjZ2NzYuNTNabS0yMi44NS02My40M2MtMTIsMC0yMS43OSw5LjM5LTIxLjgsMjUuMTZTNjUxLjcsMTg0LDY2My43NCwxODRzMjEuOC05LjM5LDIxLjgtMjUuMTZTNjc1LjgsMTMzLjcxLDY2My43NSwxMzMuNzFaIi8+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNzUwLjczLDE5OS42M2E2MC4xNiw2MC4xNiwwLDAsMS0zMC42NS04LjY5bDMuMzctMTQuMTdjNi4yLDMuNzIsMTUuNTksOC41MSwyNi45Myw4LjUxLDguMTUsMCwxMy44Mi0yLjQ4LDEzLjgyLTguODYsMC01LjQ5LTUuODUtNy40NC0xNi4zLTkuOTItMTguNzgtNC4wOC0yNS41MS0xNC0yNS41MS0yNC44MSwwLTEyLjA1LDkuMzktMjMuMzgsMzAuMTItMjMuMzgsMTIuNTgsMCwyMy41Nyw1LjQ5LDI2LDYuOTFsLTMuMzcsMTMuNDdBNDQuNTksNDQuNTksMCwwLDAsNzUzLDEzMi4zMWMtOC4zMiwwLTEyLjQsMi44My0xMi40LDcuNDQsMCw1LjEzLDUuMzIsNy40NCwxMy40Niw5LjM5LDIwLjIsNC4yNSwyOC4zNSwxMy42NCwyOC4zNSwyMy45MkM3ODIuNDUsMTg5LjUzLDc3MC40LDE5OS42Myw3NTAuNzMsMTk5LjYzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMSIgeD0iNzQuODgiIHk9IjY4LjQyIiB3aWR0aD0iMjQuMDkiIGhlaWdodD0iNTAuMDIiLz48cmVjdCBjbGFzcz0iY2xzLTEiIHg9Ijc0Ljg4IiB5PSIxNzEuMTciIHdpZHRoPSIyNC4wOSIgaGVpZ2h0PSI1MC4wMiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgeD0iNzQuODgiIHk9IjEzMy4wNCIgd2lkdGg9IjI0LjA5IiBoZWlnaHQ9IjIzLjYiLz48cmVjdCBjbGFzcz0iY2xzLTEiIHg9IjM2LjE5IiB5PSIxMDkuNTUiIHdpZHRoPSIyNC4wOSIgaGVpZ2h0PSIxNjYuMjciLz48cmVjdCBjbGFzcz0iY2xzLTEiIHg9IjExMi43OCIgeT0iMjEyLjQ0IiB3aWR0aD0iMjQuMDkiIGhlaWdodD0iNTAuMDIiLz48cmVjdCBjbGFzcz0iY2xzLTEiIHg9IjExMi43OCIgeT0iMTA5LjYxIiB3aWR0aD0iMjQuMDkiIGhlaWdodD0iNTAuMDIiLz48cmVjdCBjbGFzcz0iY2xzLTMiIHg9IjExMi43OCIgeT0iMTc0LjIzIiB3aWR0aD0iMjQuMDkiIGhlaWdodD0iMjMuNiIvPjxyZWN0IGNsYXNzPSJjbHMtMSIgeD0iMTUwLjY3IiB5PSI1NS4zOSIgd2lkdGg9IjI0LjA5IiBoZWlnaHQ9IjE2Ni4yNyIvPjwvc3ZnPg==)

Pandas es una librería de Python utiliada para creación de estructuras de datos, manipulación y análisis de los mismos. Su nombre viene de Panel Datas lo que implica que la información almacenada en sus estructuras se trabaja de forma tabular.

## Importación de librerías
Para utilizar la librería de Pandas y de Matplotlib es necesario importarlas.
"""

import pandas as pd
import matplotlib.pyplot as plt

"""## Estructuras de datos - DataFrame
El data frame es una de las estructuras de Pandas más versátiles y útiles. Están compuestos de 3 elementos:


1.   Índices
2.   Columnas
3.   Datos

Actúan como una tabla en una base de datos que puede ser filtrada y modificada conforme sea necesario.
"""

df = pd.read_csv(
    "https://raw.githubusercontent.com/menene/euro2024/main/uefa_euro_matches.csv",
    encoding="utf8",
)

"""## Análisis exploratorio"""

df.shape

df.info()

df.describe()

df.head()

"""## Manipulación de datos
Parte fundamental del trabajo con datos es la manipulación de los mismos. Tareas como limpiar la información para que esté en el formato necesario tanto para su manejo como para la optimización y las políticas de manejo de datos faltantes son necesarias para obtener los mejores resultados.
"""

df["HomeTeamName"] = df["HomeTeamName"].str.rstrip()
df["AwayTeamName"] = df["AwayTeamName"].str.lstrip()

"""## Creación de columnas
Por el análisis exploratorio que se realizó sobre los datos, es evidente la necesidad de crear una columna adicional con información útil para facilitar calculos posteriores.
"""

def result(row):
    if row["HomeTeamGoals"] > row["AwayTeamGoals"]:
        return "Home Win"
    elif row["HomeTeamGoals"] < row["AwayTeamGoals"]:
        return "Away Win"
    else:
        return "Draw"

# el parametro de axis = 1 hace referencia
# a que la operación debe aplicarse a
# cada una de las filas

df["Result"] = df.apply(result, axis=1)

df

"""## Creación de estructuras nuevas"""

home_team_performance = (
    df.groupby("HomeTeamName")
    .agg(
        home_matches_played=("HomeTeamName", "size"),
        home_goals_scored=("HomeTeamGoals", "sum"),
        home_goals_conceded=("AwayTeamGoals", "sum"),
        home_wins=("Result", lambda x: (x == "Home Win").sum()),
        home_draws=("Result", lambda x: (x == "Draw").sum()),
        home_losses=("Result", lambda x: (x == "Away Win").sum()),
    )
    .reset_index()
)

# se renombra la columna para homologar el nomre de la columna
home_team_performance.rename(columns={"HomeTeamName": "Team"}, inplace=True)

home_team_performance

away_team_performance = (
    df.groupby("AwayTeamName")
    .agg(
        away_matches_played=("AwayTeamName", "size"),
        away_goals_scored=("AwayTeamGoals", "sum"),
        away_goals_conceded=("HomeTeamGoals", "sum"),
        away_wins=("Result", lambda x: (x == "Away Win").sum()),
        away_draws=("Result", lambda x: (x == "Draw").sum()),
        away_losses=("Result", lambda x: (x == "Home Win").sum()),
    )
    .reset_index()
)

# idem con lo anterior
away_team_performance.rename(columns={"AwayTeamName": "Team"}, inplace=True)

away_team_performance

"""## Union de estructuras"""

team_performance = pd.merge(home_team_performance, away_team_performance, on="Team")

team_performance

"""## Agregaciones"""

team_performance["total_matches_played"] = (
    team_performance["home_matches_played"] + team_performance["away_matches_played"]
)

team_performance["total_goals_scored"] = (
    team_performance["home_goals_scored"] + team_performance["away_goals_scored"]
)

team_performance["total_goals_conceded"] = (
    team_performance["home_goals_conceded"] + team_performance["away_goals_conceded"]
)

team_performance["total_wins"] = (
    team_performance["home_wins"] + team_performance["away_wins"]
)

team_performance["total_draws"] = (
    team_performance["home_draws"] + team_performance["away_draws"]
)

team_performance["total_losses"] = (
    team_performance["home_losses"] + team_performance["away_losses"]
)

"""## Análisis de datos"""

team_performance["win_rate"] = (
    team_performance["total_wins"] / team_performance["total_matches_played"]
)

top_teams = team_performance.sort_values(by="win_rate", ascending=False).head(10)

top_teams

top_teams.plot(x="Team", y="win_rate", kind="bar", rot=45, legend=False, figsize=(15,5))
plt.title("Top 10 Equípos por Tasa de Victorias")
plt.xlabel("Equípo")
plt.ylabel("Tasa de Victorias")
plt.show()

team_performance["avg_goals_scored"] = (
    team_performance["total_goals_scored"] / team_performance["total_matches_played"]
)

top_scoring_teams = team_performance.sort_values(
    by="avg_goals_scored", ascending=False
).head(10)

top_scoring_teams.plot(x="Team", y="avg_goals_scored", kind="bar", rot=45, figsize=(15, 5))
plt.title("Top 10 Teams por Promedio de Goles")
plt.xlabel("Equípo")
plt.ylabel("Promedio de Goles")
plt.show()

"""## Análisis de tendencias"""

trend_analysis = (
    df.groupby("Year")
    .agg(
        total_matches=("Year", "size"),
        avg_home_goals=("HomeTeamGoals", "mean"),
        avg_away_goals=("AwayTeamGoals", "mean"),
    )
    .reset_index()
)

trend_analysis

trend_analysis.plot(x="Year", y=["avg_home_goals", "avg_away_goals"], kind="line", figsize=(15, 5))
plt.title("Average Goals Over Years")
plt.xlabel("Year")
plt.ylabel("Average Goals")
plt.show()